<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>8D Audio MP3 Tuner</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0e0e0e;
      color: #fff;
      text-align: center;
      padding: 30px;
    }
    input[type="file"] {
      margin: 10px;
    }
    canvas {
      width: 100%;
      height: 150px;
      background: black;
      border-radius: 10px;
      margin-top: 20px;
    }
    label {
      display: block;
      margin: 10px;
    }
    input[type="range"] {
      width: 80%;
    }
  </style>
</head>
<body>
  <h1>ðŸŽ§ 8D Audio MP3 Tuner</h1>
  <input type="file" id="audioFile" accept="audio/mp3,audio/mpeg" />
  <div id="controls" style="display:none;">
    <label>Bass
      <input type="range" id="bass" min="0" max="2" value="1" step="0.01">
    </label>
    <label>Mid
      <input type="range" id="mid" min="0" max="2" value="1" step="0.01">
    </label>
    <label>Treble
      <input type="range" id="treble" min="0" max="2" value="1" step="0.01">
    </label>
    <label>Gain
      <input type="range" id="gain" min="0" max="2" value="1" step="0.01">
    </label>
    <label>8D Speed (Rotation)
      <input type="range" id="speed" min="0.1" max="5" value="1" step="0.1">
    </label>
  </div>
  <canvas id="visualizer" width="600" height="150"></canvas>

  <script>
    const audioInput = document.getElementById('audioFile');
    const canvas = document.getElementById('visualizer');
    const ctx = canvas.getContext('2d');

    const bassSlider = document.getElementById('bass');
    const midSlider = document.getElementById('mid');
    const trebleSlider = document.getElementById('treble');
    const gainSlider = document.getElementById('gain');
    const speedSlider = document.getElementById('speed');
    const controls = document.getElementById('controls');

    let audioCtx, source, analyser;
    let filters = {}, gainNode, panner;
    let panAngle = 0;
    let panSpeed = 1;
    let audioBufferSource;

    function createFilter(freq) {
      const f = audioCtx.createBiquadFilter();
      f.type = 'peaking';
      f.frequency.value = freq;
      f.Q.value = 1;
      f.gain.value = 0;
      return f;
    }

    function drawVisualizer() {
      requestAnimationFrame(drawVisualizer);
      const bufferLength = analyser.fftSize;
      const dataArray = new Uint8Array(bufferLength);
      analyser.getByteTimeDomainData(dataArray);

      ctx.fillStyle = "#000";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.lineWidth = 2;
      ctx.strokeStyle = "#00ffcc";
      ctx.beginPath();

      const sliceWidth = canvas.width / bufferLength;
      let x = 0;

      for (let i = 0; i < bufferLength; i++) {
        const v = dataArray[i] / 128.0;
        const y = (v * canvas.height) / 2;
        i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
        x += sliceWidth;
      }

      ctx.lineTo(canvas.width, canvas.height / 2);
      ctx.stroke();
    }

    function updateFilters() {
      filters.bass.gain.value = parseFloat(bassSlider.value) * 10 - 10;
      filters.mid.gain.value = parseFloat(midSlider.value) * 10 - 10;
      filters.treble.gain.value = parseFloat(trebleSlider.value) * 10 - 10;
      gainNode.gain.value = parseFloat(gainSlider.value);
      panSpeed = parseFloat(speedSlider.value);
    }

    function start8DAudioRotation() {
      setInterval(() => {
        panAngle += 0.01 * panSpeed;
        const x = Math.sin(panAngle);
        const z = Math.cos(panAngle);
        panner.setPosition(x, 0, z);
      }, 16); // ~60fps
    }

    audioInput.addEventListener('change', async function () {
      const file = this.files[0];
      if (!file) return;

      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();

      const arrayBuffer = await file.arrayBuffer();
      const audioBuffer = await audioCtx.decodeAudioData(arrayBuffer);

      if (audioBufferSource) {
        audioBufferSource.stop();
      }

      audioBufferSource = audioCtx.createBufferSource();
      audioBufferSource.buffer = audioBuffer;

      filters.bass = createFilter(100);
      filters.mid = createFilter(1000);
      filters.treble = createFilter(5000);
      gainNode = audioCtx.createGain();
      analyser = audioCtx.createAnalyser();
      analyser.fftSize = 2048;

      panner = audioCtx.createPanner();
      panner.panningModel = 'HRTF';
      panner.setPosition(0, 0, 1);

      // Connect the nodes
      audioBufferSource
        .connect(filters.bass)
        .connect(filters.mid)
        .connect(filters.treble)
        .connect(gainNode)
        .connect(panner)
        .connect(analyser)
        .connect(audioCtx.destination);

      controls.style.display = 'block';
      updateFilters();
      drawVisualizer();
      start8DAudioRotation();
      audioBufferSource.start();
    });

    [bassSlider, midSlider, trebleSlider, gainSlider, speedSlider].forEach(slider => {
      slider.addEventListener('input', updateFilters);
    });
  </script>
</body>
</html>
